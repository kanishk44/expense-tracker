<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <style>
      .expense-form {
        margin-bottom: 20px;
      }
      .expense-list {
        width: 100%;
        border-collapse: collapse;
      }
      .expense-list th,
      .expense-list td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      .expense-list th {
        background-color: #f4f4f4;
      }
    </style>
  </head>
  <body>
    <h1>Expense Tracker</h1>

    <div class="expense-form">
      <h2>Add New Expense</h2>
      <form id="expenseForm">
        <input
          type="text"
          id="description"
          placeholder="Description"
          required
        />
        <input
          type="number"
          id="amount"
          placeholder="Amount"
          step="0.01"
          required
        />
        <button type="submit">Add Expense</button>
      </form>
    </div>

    <div class="expense-list-container">
      <h2>Expenses</h2>
      <table class="expense-list">
        <thead>
          <tr>
            <th>Description</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="expenseTableBody"></tbody>
      </table>
    </div>

    <script>
      // Fetch and display expenses
      function loadExpenses() {
        fetch("/api/expenses")
          .then((response) => response.json())
          .then((expenses) => {
            const tableBody = document.getElementById("expenseTableBody");
            tableBody.innerHTML = "";

            expenses.forEach((expense) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                            <td>${expense.description}</td>
                            <td>$${expense.amount}</td>
                            <td>${new Date(
                              expense.date
                            ).toLocaleDateString()}</td>
                            <td>
                                <button onclick="editExpense(${
                                  expense.id
                                })">Edit</button>
                                <button onclick="deleteExpense(${
                                  expense.id
                                })">Delete</button>
                            </td>
                        `;
              tableBody.appendChild(row);
            });
          });
      }

      // Add new expense
      document.getElementById("expenseForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const description = document.getElementById("description").value;
        const amount = document.getElementById("amount").value;

        fetch("/api/expenses", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ description, amount }),
        }).then(() => {
          document.getElementById("expenseForm").reset();
          loadExpenses();
        });
      });

      // Delete expense
      function deleteExpense(id) {
        if (confirm("Are you sure you want to delete this expense?")) {
          fetch(`/api/expenses/${id}`, {
            method: "DELETE",
          }).then(() => loadExpenses());
        }
      }

      // Edit expense
      function editExpense(id) {
        const newDescription = prompt("Enter new description:");
        const newAmount = prompt("Enter new amount:");

        if (newDescription && newAmount) {
          fetch(`/api/expenses/${id}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              description: newDescription,
              amount: newAmount,
            }),
          }).then(() => loadExpenses());
        }
      }

      // Load expenses when page loads
      loadExpenses();
    </script>
  </body>
</html>
